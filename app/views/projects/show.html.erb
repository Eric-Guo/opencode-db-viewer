<div class="row justify-content-center">
  <div class="col-lg-12">
    <div class="container">

      <%# === Project Info Card === %>
      <div class="card mb-4">
        <div class="card-header bg-primary text-white d-flex align-items-center">
          <svg class="icon me-2">
            <use xlink:href="<%= asset_path('free.svg') %>#cil-folder-open"></use>
          </svg>
          <strong><%= t(".project_info") %></strong>
        </div>
        <div class="card-body">
          <div class="row g-3">

            <%# Name %>
            <div class="col-md-6">
              <div class="border rounded p-3 h-100">
                <div class="text-medium-emphasis small text-uppercase fw-semibold mb-1"><%= t(".name") %></div>
                <div class="fs-5 fw-semibold"><%= @project.name.presence || @project.id %></div>
              </div>
            </div>

            <%# Worktree %>
            <div class="col-md-6">
              <div class="border rounded p-3 h-100">
                <div class="text-medium-emphasis small text-uppercase fw-semibold mb-1"><%= t(".worktree") %></div>
                <div class="fs-6"><code><%= @project.worktree %></code></div>
              </div>
            </div>

            <%# VCS %>
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="text-medium-emphasis small text-uppercase fw-semibold mb-1"><%= t(".vcs") %></div>
                <% if @project.vcs.present? %>
                  <span class="badge bg-info-gradient text-white"><%= @project.vcs %></span>
                <% else %>
                  <span class="text-medium-emphasis">-</span>
                <% end %>
              </div>
            </div>

            <%# Created At %>
            <% created_time = @project.time_created_at %>
            <% created_text = created_time&.strftime("%Y-%m-%d %H:%M:%S") || "-" %>
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="text-medium-emphasis small text-uppercase fw-semibold mb-1"><%= t(".time_created") %></div>
                <% if created_time %>
                  <div><%= time_tag(created_time, t(".time_ago", distance: time_ago_in_words(created_time)), title: created_text) %></div>
                  <div class="small text-medium-emphasis"><%= created_text %></div>
                <% else %>
                  <span class="text-medium-emphasis">-</span>
                <% end %>
              </div>
            </div>

            <%# Updated At %>
            <% updated_time = @project.time_updated_at %>
            <% updated_text = updated_time&.strftime("%Y-%m-%d %H:%M:%S") || "-" %>
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="text-medium-emphasis small text-uppercase fw-semibold mb-1"><%= t(".time_updated") %></div>
                <% if updated_time %>
                  <div><%= time_tag(updated_time, t(".time_ago", distance: time_ago_in_words(updated_time)), title: updated_text) %></div>
                  <div class="small text-medium-emphasis"><%= updated_text %></div>
                <% else %>
                  <span class="text-medium-emphasis">-</span>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      </div>

      <%# === Stats Summary === %>
      <div class="row g-3 mb-4">
        <div class="col-sm-4">
          <div class="card text-white bg-primary">
            <div class="card-body d-flex align-items-center">
              <svg class="icon icon-3xl me-3">
                <use xlink:href="<%= asset_path('free.svg') %>#cil-layers"></use>
              </svg>
              <div>
                <div class="fs-4 fw-semibold"><%= @total_sessions %></div>
                <div class="text-white text-opacity-75"><%= t(".total_sessions") %></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="card text-white bg-success">
            <div class="card-body d-flex align-items-center">
              <svg class="icon icon-3xl me-3">
                <use xlink:href="<%= asset_path('free.svg') %>#cil-plus"></use>
              </svg>
              <div>
                <div class="fs-4 fw-semibold"><%= @total_additions %></div>
                <div class="text-white text-opacity-75"><%= t(".total_additions") %></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="card text-white bg-danger">
            <div class="card-body d-flex align-items-center">
              <svg class="icon icon-3xl me-3">
                <use xlink:href="<%= asset_path('free.svg') %>#cil-minus"></use>
              </svg>
              <div>
                <div class="fs-4 fw-semibold"><%= @total_deletions %></div>
                <div class="text-white text-opacity-75"><%= t(".total_deletions") %></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# === Sessions Table === %>
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
          <svg class="icon me-2">
            <use xlink:href="<%= asset_path('free.svg') %>#cil-chat-bubble"></use>
          </svg>
          <strong><%= t(".sessions") %></strong>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0 align-middle">
              <thead class="table-light">
                <tr>
                  <th><%= t(".session_title") %></th>
                  <th><%= t(".session_version") %></th>
                  <th class="text-center"><%= t(".session_files") %></th>
                  <th class="text-center text-success"><%= t(".session_additions") %></th>
                  <th class="text-center text-danger"><%= t(".session_deletions") %></th>
                  <th><%= t(".session_directory") %></th>
                  <th><%= t(".session_time_created") %></th>
                  <th><%= t(".session_time_updated") %></th>
                </tr>
              </thead>
              <tbody>
                <% if @sessions.load.any? %>
                  <% @sessions.each do |session| %>
                    <% s_created = session.time_created_at %>
                    <% s_updated = session.time_updated_at %>
                    <% s_created_text = s_created&.strftime("%Y-%m-%d %H:%M:%S") || "-" %>
                    <% s_updated_text = s_updated&.strftime("%Y-%m-%d %H:%M:%S") || "-" %>
                    <tr>
                      <td>
                        <div class="fw-semibold"><%= link_to (session.title.presence || session.slug), project_session_path(@project, session), class: "text-decoration-none" %></div>
                        <% if session.time_archived_at %>
                          <span class="badge bg-secondary"><%= t(".archived") %></span>
                        <% end %>
                      </td>
                      <td><span class="badge bg-light text-dark"><%= session.version %></span></td>
                      <td class="text-center"><%= session.summary_files || 0 %></td>
                      <td class="text-center text-success fw-semibold">+<%= session.summary_additions || 0 %></td>
                      <td class="text-center text-danger fw-semibold">-<%= session.summary_deletions || 0 %></td>
                      <td><code class="small"><%= truncate(session.directory, length: 40) %></code></td>
                      <td>
                        <% if s_created %>
                          <%= time_tag(s_created, t(".time_ago", distance: time_ago_in_words(s_created)), title: s_created_text) %>
                          <div class="small text-medium-emphasis"><%= s_created_text %></div>
                        <% else %>
                          -
                        <% end %>
                      </td>
                      <td>
                        <% if s_updated %>
                          <%= time_tag(s_updated, t(".time_ago", distance: time_ago_in_words(s_updated)), title: s_updated_text) %>
                          <div class="small text-medium-emphasis"><%= s_updated_text %></div>
                        <% else %>
                          -
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                <% else %>
                  <tr>
                    <td class="text-center text-medium-emphasis py-4" colspan="8"><%= t(".no_sessions") %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <% if @pagy.pages > 1 %>
          <div class="card-footer">
            <%== pagy_bootstrap_nav(@pagy) %>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</div>
